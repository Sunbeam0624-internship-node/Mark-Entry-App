<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>show students</title>
    <link
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css"
    />
</head>
<body>
  <center>
  <div>
    <br>
    <table>
      <tr>
        <td>Roll No</td>
        <td >
          <input type="number" id="rollno">
        </td>
      </tr>
      <tr>
        <td>Student Name</td>
        <td><input type="text" id="studentname"></td>
      </tr>
      <tr>
        <td>Email</td>
        <td>
          <input type="email" id="email">
        </td>
      </tr>
      <tr>
        <td>Group Name</td>
        <td>
          <input type="text" id="groupname">
        </td>
      </tr>
      <tr>
        
        <td colspan="2">
          <center>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        <button type="submit" class="btn btn-primary" onclick="Add()" id="btnAdd">Add</button>
        </center>
        </td>
        
      </tr>
    </table>
  </div>
  </center>
    <br> <br>
    <center>
        <table border="1" width="75%" style="text-align: center;border-collapse: collapse;" >
            <thead>
            <tr>
                <th>Roll No</th>
                <th>Student Name</th>
                <th>Email</th>
                <th>Group Name</th>
                <th>Action</th>
                

              </tr>
            </thead>
            <tbody id="tableBody"></tbody>
        </table>
    </center>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jwt-decode@3.1.2/build/jwt-decode.min.js"></script>
    <script>
      
      function add()
        {
          var rollno=document.getElementById("rollno");
          var studentname=document.getElementById("studentname");
          var email=document.getElementById("email");
          var groupname=document.getElementById("groupname");
          var token=localStorage.getItem("token");

          fetch("http://127.0.0.1:5000/coordinator/updateStudent", {
            
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                  "authorization" : "Token " + token,
                  
                },
                body: JSON.stringify({
                  rollno: rollno.value,
                  studentname: studentname.value,
                  email: email.value,
                  groupname: groupname.value,
                }),
              })
              .then((response) => response.json())
              .then((data)=> {
                
                const data2=data;
                console.log("data2:",data2);
                if(data2.data.affectedRows>0) {
                alert("record added successfully");
                getdata();
              } else{
                alert("something went wrong");
              }
              });             
}
      function Edit(No)
    {
      console.log("# ",No);
      let roll=No;
      var rollno=document.getElementById("rollno");
      var studentname=document.getElementById("studentname");
      var email=document.getElementById("email");
      var groupname=document.getElementById("groupname");
      var token=localStorage.getItem("token");
        fetch("http://127.0.0.1:5000/coordinator/getstudent" ,{
          method: "POST",
          headers: {
                  "Content-Type": "application/json",
                  "authorization" : "Token " + token,
                  },
                  body: JSON.stringify({
                    rollNo: roll,
                  
                }),
                  
        })

        .then((response) => response.json())
        .then((data)=> {
         // console.log("data:",data);
          //const data1=data.json();
         // console.log("data1 ",data1);
          const data2=data;
          console.log("data2: ",data2.data[0].group_id);
          rollno.value=data2.data[0].roll_number;
          studentname.value=data2.data[0].student_name;
          email.value=data2.data[0].email;
          groupname.value=data2.data[0].group_id;

    
        });
    }
      
        function getdata()
      {
        var token=localStorage.getItem("token");
        fetch("http://127.0.0.1:5000/coordinator/showstudent", {
          method: "GET",
          headers: {
                  "Content-Type": "application/json",
                  "authorization" : "Token " + token,
                  },
        })
        .then((response) => response.json())
        .then((data)=> {
         // console.log("data:",data);
          //const data1=data.json();
         // console.log("data1 ",data1);
          const data2=data;
          console.log("data2 ",data2);
          console.log("data2 length is:",data2.data.length);
          var refToMyTable = document.getElementById("tableBody");
            //refToMyTable.innerHTML = users;
            refToMyTable.innerHTML='';
            for (let i = 0; i < data2.data.length; i++) {
              console.log("Inside get course for loop");
              var user = data2.data[i];
              //console.log("user:",user);
              var row = `<tr>
                                    <td>${user.roll_number}</td>
                                    <td>${user.student_name}</td>
                                    <td>${user.email}</td>
                                    <td>${user.group_id}</td>
                                    <td>
                                       <button onclick="Edit(${user.roll_number})" class="btn btn-primary">
                                        Update
                                       </button>
                                    </td>

                        </tr>`;
              refToMyTable.innerHTML = refToMyTable.innerHTML + row;
              
                      }
    
        });
    }
    getdata();
    </script>
</body>
</html>